Part of this was created in collaboration with cyrill.
